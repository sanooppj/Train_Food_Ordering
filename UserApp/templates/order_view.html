{% load static %}
<html>

<head>
  <!-- Basic -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <!-- Mobile Metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <!-- Site Metas -->
  <meta name="keywords" content="" />
  <meta name="description" content="" />
  <meta name="author" content="" />
  <link rel="shortcut icon" href="{% static 'Web/images/favicon.png' %}" type="">

  <title> Train Treats</title>

  <!--owl slider stylesheet -->
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />
  <!-- nice select  -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/css/nice-select.min.css" integrity="sha512-CruCP+TD3yXzlvvijET8wV5WxxEh5H8P4cmz0RFbKK6FlZ2sYl3AEsKlLPHbniXKSrDdFewhbmBK5skbdsASbQ==" crossorigin="anonymous" />
  <!-- font awesome style -->
  <link href="{% static 'Web/css/font-awesome.min.css' %}" rel="stylesheet" />

  <!-- Custom styles for this template -->
  <link href="{% static 'Web/css/style.css' %}" rel="stylesheet" />
  <!-- responsive style -->
  <link href="{% static 'Web/css/responsive.css' %}" rel="stylesheet" />
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500&display=swap" rel="stylesheet">


      <link href="{% static 'Web/css/bootstrap-select.min.css' %}" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="{% static 'Web/css/bootstrap.css' %}" rel="stylesheet">

  <style>
    .section-title h3 {
  font-size: 40px;
  position: relative;
  padding-bottom: 15px;
}

.section-title h3:after {
  position: absolute;
  content: '';
  left: 0px;
  right: 0px;
  bottom: 0px;
  width: 50px;
  height: 2px;
  background-color: #F28123;
  margin: 0 auto;
}

.section-title p {
  font-size: 15px;
  width: 530px;
  margin: 0 auto;
  color: #555;
  margin-top: 10px;
  line-height: 1.8;
}
.logo-carousel-section {
  background-color: #f5f5f5;
  padding: 50px 0;
}
.single-logo-item img {
  max-width: 180px;
  margin: 0 auto;
}
.logo-carousel-inner {
  display: flex; /* Use flexbox */
  justify-content: center; /* Align items horizontally */
  align-items: center; /* Align items vertically */
  flex-wrap: nowrap; /* Prevent wrapping to ensure all items stay in one line */
}

.single-logo-item {
  margin-right: 10px; /* Adjust margin between items */
}


.section-title {
  margin-bottom: 80px;
}
.carousel-container {
  overflow-x: auto;
  white-space: nowrap;
  padding-bottom: 20px; /* Adjust as needed */
  /* Hide scrollbar */
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none; /* Internet Explorer 10+ */
}

.carousel-container::-webkit-scrollbar {
  display: none; /* WebKit */
}

.logo-carousel-inner {
  display: inline-block;
  vertical-align: top;
  white-space: nowrap;
}

.single-logo-item {
  display: inline-block;
}



.custom-btn{
color:white;
background-color:#6909bd;
border-radius:10px;
border: 1px solid #6909bd !important;
}
.custom-btn:hover{
      color:white;
background-color:#470581;
border-radius:10px;
border: 1px solid #470581; !important;
      }


    .bootstrap-select .dropdown-toggle:focus {
    outline: none !important;
    box-shadow: none !important;
}
     .custom-drop
{
    border: 2px solid rgb(148, 10, 198) !important;
    border-radius:30px !important;

}


        .alert-container {
            position: fixed;
            top: -100px; /* Initially off-screen */
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            width: 100%;
            max-width: 400px; /* Adjust width as needed */
            text-align: center;
            animation: slideDown 0.5s forwards;
        }

        @keyframes slideDown {
            0% {
                top: -100px; /* Off-screen */
            }
            100% {
                top: 100px; /* 100px down from top */
            }
        }

.alert {
	position: relative;
	margin-bottom: 15px;
	border: 1px solid transparent;
	border-radius: .25rem;
}

.alert-success {
	color: black;
    background-color:white;
	border: 1px solid green !important;
	font-size:15px;
	font-weight:bold;
}

.alert-warning {
	color: black;
    background-color:white;
	border: 1px solid #F28123 !important;
	font-size:15px;
	font-weight:bold;
}

.alert-error {
    color: black;
    background-color:white;
	border: 1px solid #F28123 !important;
	font-size:15px;
	font-weight:bold;
}





/* Custom styles for the modal */
  #confirmCancelModal .modal-dialog {
    max-width: 480px; /* Set the max-width */
    margin: 100px auto 0; /* Center the modal horizontally and set distance from top to 100px */
  }

  #confirmCancelModal .modal-content {
    height: 270px; /* Set the height */
    background-color: white;
    border:1px double #fd7e14;
    border-radius: 10px; /* Add border radius of 10px */
    padding: 20px 20px 0; /* Adjusted padding without bottom padding */
}





.status {
    position: relative;
    margin-top: 20px;
    height: 50px;
}

.dot {
    width: 20px;
    height: 20px;
    background-color: #ccc;
    border-radius: 50%;
    position: absolute;
    top: 138%;
    transform: translateY(-50%);
    left: 30px;
}


.dot:nth-child(1) { left: 0%; }
.dot:nth-child(2) { left: 30%; }
.dot:nth-child(3) { left: 60%; }
.dot:nth-child(4) { left: 90%; }

.line {
    position: absolute;
    background-color: #ccc;
    width: calc(88%); /* Adjusted to accommodate dots */
    height: 2px;
    top: 138%;
    transform: translateY(-50%);
    left: 30px; /* Adjusted to center the line */
}
@keyframes moveLight {
    0% { left: 3%; }
    30% { left: 30%; }
    50% { left: 60%; }
    100% { left: 90%; } /* Adjusted to reach the last dot */
}


.cancelled-text {
    margin-top: 20px;
    font-size: 18px;
    font-weight: bold;
    color: red;
}




.light {
    width: 20px;
    height: 20px;
    background-color: #6909bd;
    border-radius: 50%;
    position: absolute;
    animation: moveLight 40s ;
}





  </style>

</head>

<body class="sub_page">

  <div class="hero_area">
    <div class="bg-box">
      <img src="{% static 'Web/images/hero-bg.jpg' %}" alt="">
    </div>
    <!-- header section strats -->
    <header class="header_section">
      <div class="container">
        <nav class="navbar navbar-expand-lg custom_nav-container ">
          <a class="navbar-brand" href="index.html">
            <span style="margin-right:-30px;">
TrainTreats
            </span>
          </a>

          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class=""> </span>
          </button>

          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ">
              <li class="nav-item ">
                <a class="nav-link" href="{% url 'Home_page' %}">Home</a>
              </li>
              <li class="nav-item active">
                <a class="nav-link" href="{% url 'menu_page' %}">Menu  <span class="sr-only">(current)</span></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{% url 'about_page' %}">About</a>
              </li>
               <li class="nav-item">
                <a class="nav-link" href="book.html" >Contact</a>
              </li>
            </ul>
           <div class="user_option">
{% if request.session.Username %}

            <a href="{% url 'profile_page' %}" class="user_link customicon" style="margin-right:190px;">
    <i class="fa fa-user" aria-hidden="true"></i>
</a>
{% else %}

<a href="{% url 'login_page' %}" class="user_link" style="margin-right:190px;">
  <i class="fa fa-user-plus"  aria-hidden="true"></i>
</a>
{% endif %}
<a class="cartcustom" href="{% url 'cart_page' %}">
    <i class="fas fa-shopping-cart"></i>
</a>
              <form class="form-inline">
                <button class="btn  my-2 my-sm-0 nav_search-btn" type="submit">
                  <i class="fa fa-search" style="margin-top:16px;" aria-hidden="true"></i>
                </button>
              </form>
        <a href="{% url 'menu_page' %}" style="text-decoration:none !important;" class="order_online">
                Search
              </a>

            </div>
          </div>
        </nav>
      </div>
    </header>
    <!-- end header section -->
  </div>


<div class="container my-3">
    <div class="row">
      <div class="col-md-12" style="margin-top: 70px">
        <div class="card shadow" style="margin-top: 40px; padding-left: 23px">
          <div class="card-header">
            <h3>View order</h3>
            <a href="{% url 'profile_orders' %}" class="btn-3 float-end">
              <b><i class="fa fa-reply">&nbsp;</i>Back</b> </a
            >
          </div><br>
                     {% if order.order_status != 'Order Cancelled'  %}

          <div class="status order-tracking-style" id="statusDiv">
                     
            <h3 style="margin-bottom: 26px;">Order Tracking</h3>

                <div class="dot" id="dot1"></div>
                <div class="dot" id="dot2"></div>
                <div class="dot" id="dot3"></div>
                <div class="dot" id="dot4"></div>
                <div class="line" id="line1"></div>
                <div class="line" id="line2"></div>
                <div class="line" id="line3"></div>
                <div class="light" id="light"></div><br>

                <!-- Light element for animation -->
                <div style="margin-top: 10px;">
                    <span style="margin-right: 16%;">Order Placed</span>
                    <span style="margin-right: 20%;">Order Processing</span>
                    <span style="margin-right: 20%;">Out For Delivery</span>
                    <span>Delivered</span>
                </div>
            {% else %}
                <div class="cancelled-text">
                    <p>Order Cancelled</p>
                </div>
            {% endif %}
        </div>

        <br><br><br><br>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <h4>Shipping Details</h4>
                <hr />
                <label class="mt-2" style="font-weight:bold;"> Name</label>
                <div class="border p-1">
                    {{ order.booking.Username}}
                </div>

                <label class="mt-2" style="font-weight:bold;">Email</label>
                <div class="border p-1">{{order.booking.email}}</div>
                <label class="mt-2" style="font-weight:bold;">Phone Number</label>
                <div class="border p-1">{{order.booking.mobile_number}}</div>


                <label class="mt-2" style="font-weight:bold;">Train Number</label>
                <div class="border p-1">
                  {{order.booking.train_number}} <br />
                </div>
                  <label class="mt-2" style="font-weight:bold;">Compartment Number</label>
                <div class="border p-1">
                  {{order.booking.compartment_number}} <br />
                </div>
                  <label class="mt-2" style="font-weight:bold;">Seat Number</label>
                <div class="border p-1">
                  {{order.booking.seat_number}} <br />
                </div>
                  <label class="mt-2" style="font-weight:bold;">Deliver Station</label>
                <div class="border p-1">
                  {{order.booking.deliver_station}} <br />
                </div>
              </div>
              <div class="col-md-6">
                <h4>Order Details</h4>
                <table class="table table-borderless">
                  <thead class="text-muted">
                    <tr class="small text-uppercase">
                      <th scope="col">Item</th>
                      <th scope="col">Quantity</th>
                      <th scope="col">Product Price</th>
                      <th scope="col"></th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for item in order.orderitem_set.all %}
                    <tr>
                      <td>
                        <figure class="itemside align-items-center">
                          <div class="how-itemcart1">
                            <img
                              src="{{ item.picture.url }}"
                              style="height: 100px;width: 200px;object-fit: cover;"
                              alt="IMG"/>
                          </div>
                        </figure>
                      </td>
                      <td class="column">
                        <label class="my-3" for="">x{{ item.quantity }}</label>
                      </td>
                      <td>
                        <div class="price-wrap my-3">
                          <var class="price">₹ {{item.price}}</var><br />

                        </div>
                        <!-- price-wrap .// -->
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
                <hr />
                <div>

                  <br />
                <h5>

                  Grand Total:  &nbsp; &nbsp; ₹{{order.grand_total}}
                  <br />
                  </h5>
                  <br />
                  <h6>Payment Mode : {{order.payment_method}}</h6>
                  <br />
                  {% if order.order_status != 'Order Cancelled' %}
                  <h6>
                    Order Status:
                    <span class="text-success">{{order.order_status}}</span>
                  </h6>

                  <br />
                  {% else %}
                  <h6>
                    Order Status:
                    <span class="text-danger">{{order.order_status}}</span>
                  </h6>
                  <br />
                  {% endif %}
                  <h6>Order Id : {{order.order_id}}</h6>
                  <br />


         {% if order.order_status != 'Order Cancelled' and order.order_status != 'Delivered' %}
    <h6>
        <button type="button" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#confirmCancelModal">Cancel Order</button>
    </h6>
{% else %}
    <h6>
        <a href="#" class="btn btn-secondary btn-sm disabled" role="button" aria-disabled="true">
            {% if order.order_status == 'Order Cancelled' %}
                Cancelled
            {% elif order.order_status == 'Delivered' %}
                Delivered
            {% endif %}
        </a>
    </h6>
{% endif %}


<!-- Modal -->
 <div class="modal fade" id="confirmCancelModal" tabindex="-1" role="dialog" aria-labelledby="confirmCancelModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
              					<i class="fas fa-exclamation-circle" style="margin-top:2px;margin-right:6px !important;font-size:20px !important"></i>
            <h5 class="modal-title" id="confirmCancelModalLabel">Are you sure you want to cancel this order? <span><p>your order will be deleted permanently cancelled.</p></span></h5>

            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-footer">
			  <form id="cancelOrderForm" action="{% url 'cancel_order' order_id=order.id %}" method="post">
                    {% csrf_token %}
					  <button type="button" class="btn btn-secondary " data-dismiss="modal">Close</button>
				  &nbsp;
                    <button type="submit" class="btn btn-primary " id="cancelOrderButton" name="confirm_cancel">Confirm</button>
                </form>
           </div>
        </div>
      </div>
    </div>


                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

 <!-- footer section -->
  <footer class="footer_section">
    <div class="container">
      <div class="row">
        <div class="col-md-4 footer-col">
          <div class="footer_contact">
            <h4>
              Contact Us
            </h4>
            <div class="contact_link_box">
              <a href="">
                <i class="fa fa-map-marker" aria-hidden="true"></i>
                <span>
                  Location
                </span>
              </a>
              <a href="">
                <i class="fa fa-phone" aria-hidden="true"></i>
                <span>
                  Call +01 1234567890
                </span>
              </a>
              <a href="">
                <i class="fa fa-envelope" aria-hidden="true"></i>
                <span>
                  demo@gmail.com
                </span>
              </a>
            </div>
          </div>
        </div>
        <div class="col-md-4 footer-col">
          <div class="footer_detail">
            <a href="" class="footer-logo">
              Feane
            </a>
            <p>
              Necessary, making this the first true generator on the Internet. It uses a dictionary of over 200 Latin words, combined with
            </p>
            <div class="footer_social">
              <a href="">
                <i class="fa fa-facebook" aria-hidden="true"></i>
              </a>
              <a href="">
                <i class="fa fa-twitter" aria-hidden="true"></i>
              </a>
              <a href="">
                <i class="fa fa-linkedin" aria-hidden="true"></i>
              </a>
              <a href="">
                <i class="fa fa-instagram" aria-hidden="true"></i>
              </a>
              <a href="">
                <i class="fa fa-pinterest" aria-hidden="true"></i>
              </a>
            </div>
          </div>
        </div>
        <div class="col-md-4 footer-col">
          <h4>
            Opening Hours
          </h4>
          <p>
            Everyday
          </p>
          <p>
            10.00 Am -10.00 Pm
          </p>
        </div>
      </div>
      <div class="footer-info">
        <p>
          &copy; <span id="displayYear"></span> All Rights Reserved By
          <a href="https://html.design/">Free Html Templates</a><br><br>
          &copy; <span id="displayYear"></span> Distributed By
          <a href="https://themewagon.com/" target="_blank">ThemeWagon</a>
        </p>
      </div>
    </div>
  </footer>
  <!-- footer section -->
  <div class="alert-container">
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {% if message.tags == 'error' %}
                    <img src="{% static 'Web/images/error.png' %}" alt="Error Icon" style="margin-right:10px;" width="30px" height="28px"> <!-- Replace path/to/error-image.jpg with the path to your error image -->
                                {{ message }}

				{% endif %}
				{% if message.tags == 'success' %}
                    <img src="{% static 'Web/images/green_tick.jpg' %}" alt="Error Icon" width="30px" height="28px">
                                {{ message }}

				{% endif %}
				{% if message.tags == 'warning' %}
                    <img src="{% static 'Web/images/warningicon.png' %}" style="margin-top:-7px !important;" alt="Error Icon" width="30px" height="28px">
                               {{ message }}

                {% endif %}
            </div>
        {% endfor %}
    {% endif %}
</div>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

	<script>
    $(document).ready(function() {
        // Hide alerts after 5 seconds
        setTimeout(function() {
            $('.alert-container').fadeOut('medium');
        }, 3000);
    });
</script>
<script>
  // JavaScript code to handle order status and dots
document.getElementById('light').addEventListener('animationiteration', function() {
    var currentIndex = Math.round(parseInt(document.getElementById('light').style.left) / 20);
});

// Check if order status is not "Delivered" or "Cancelled"
var orderStatus = "{{ order.order_status }}"; // Get order status from your backend
if (orderStatus != "Delivered" && orderStatus != "Order Cancelled") {
    // Animation to update order status to "Delivered" when animation ends
    document.getElementById('light').addEventListener('animationend', function() {
        $.ajax({
            type: 'POST',
            url: '{% url "update_order_status" %}',
            data: {'light_position': 'Delivered', 'order_id': '{{ order.id }}'},
            success: function(response) {
              window.location.reload();
                console.log(response.message);
            },
            error: function(xhr, status, error) {
                console.error(error);
            }
        });
    });
    // Set animation end position to "Delivered"
    document.getElementById('light').addEventListener('animationend', function() {
        document.getElementById('light').style.left = '90%' ;
    });
} else {
    // If order status is "Delivered" or "Cancelled", stop the animation
    document.getElementById('light').style.animation = 'none';
    document.getElementById('light').style.left = '90%' ;
}

</script>

   <!-- from another code -->
    <script src="{% static 'Web/js/jquery.min.js' %}"></script>
    <script src="{% static 'Web/js/bootstrap.bundle.min.js' %}"></script>


    <script src="{% static 'Web/js/bootstrap-select.min.js' %}"></script>


  <!-- popper js -->
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
  </script>
  <!-- bootstrap js -->
  <script src="{% static 'Web/js/bootstrap.js' %}"></script>
  <!-- owl slider -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js">
  </script>
  <!-- isotope js -->
  <script src="https://unpkg.com/isotope-layout@3.0.4/dist/isotope.pkgd.min.js"></script>
  <!-- nice select -->
  <!-- custom js -->
  <script src="{% static 'Web/js/custom.js' %}"></script>
  <!-- Google Map -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCh39n5U-4IoWpsVGUHWdqB6puEkhRLdmI&callback=myMap">
  </script>
  <!-- End Google Map -->

</body>

</html>